<app-navbar></app-navbar>
<!-- ⏳ Timer Display -->
<div *ngIf="!submitted" class="timer-box text-center my-3">
    <p>⏳ Time Remaining: <strong>{{ getFormattedTime() }}</strong></p>
</div>

<!-- ✅ Message Si Temps Écoulé -->
<div *ngIf="isTimeUp" class="alert alert-danger text-center">
    ❌ Time is up! Your quiz has been automatically submitted.
</div>
<!-- 🏆 HEADER du Quiz -->
<section class="page-header page-header--bg-two" data-jarallax data-speed="0.3">
    <div class="page-header__bg jarallax-img"></div>
    <div class="page-header__overlay"></div>
    <div class="container text-center">
        <h2 class="page-header__title">🎯 {{ quiz?.quizName }}</h2>
        <ul class="page-header__breadcrumb list-unstyled">
            <li><a routerLink="/">Training</a></li>
            <li><span>Quiz</span></li>
        </ul>
    </div>
</section>

<section class="quiz-section">
    <div class="quiz-container">
        <h3 class="quiz-title">📝 Answer the Questions Below</h3>

        <!-- ⏳ Timer Box -->
        <div *ngIf="!submitted" class="timer-box text-center my-3">
            <p>⏳ Time Remaining: <strong>{{ getFormattedTime() }}</strong></p>
        </div>

        <!-- ✅ Message si le temps est écoulé -->
        <div *ngIf="isTimeUp" class="alert alert-danger text-center">
            ❌ Time is up! Your quiz has been automatically submitted.
        </div>

        <div *ngIf="!questions?.length" class="text-center">
            <p class="alert alert-info">📌 Loading questions...</p>
        </div>

        <div *ngIf="questions?.length" class="quiz-card">
            <div class="progress-indicator">
                <span>Question {{ currentQuestionIndex + 1 }} / {{ questions.length }}</span>
            </div>

            <h4 class="question-title">
                <span class="question-number">❓ Question {{ currentQuestionIndex + 1 }}:</span>
                {{ questions[currentQuestionIndex]?.questionText }}
            </h4>

            <div class="answers-container">
                <div *ngFor="let answer of questions[currentQuestionIndex]?.quizAnswers" class="answer-option">
                    <label class="answer-label">
                        <input 
                            type="radio" 
                            [value]="answer.idQuizA"
                            [(ngModel)]="selectedAnswers[questions[currentQuestionIndex].idQuizQ]"
                            [name]="'question-' + questions[currentQuestionIndex].idQuizQ"
                            class="form-check-input"
                        />
                        <span class="answer-text">✅ {{ answer.answerText }}</span>
                    </label>
                </div>
            </div>

            <!-- 🚀 Navigation entre les questions -->
            <div class="quiz-navigation">
                <button (click)="previousQuestion()" class="btn btn-secondary" [disabled]="currentQuestionIndex === 0">
                    ⬅️ Previous
                </button>
                <button (click)="nextQuestion()" class="btn btn-primary" *ngIf="currentQuestionIndex < questions.length - 1">
                    Next ➡️
                </button>
                <button (click)="submitQuiz()" class="btn btn-success" *ngIf="currentQuestionIndex === questions.length - 1">
                    ✅ Submit
                </button>
            </div>
        </div>
    </div>
</section>



<!-- ✅ Résultat du quiz directement sous la carte -->
<div *ngIf="submitted" class="quiz-result-container">
    <div class="score-card shadow-lg p-4 rounded animate-fade-in">
        <!-- 🎊 Message Dynamique (Succès ou Échec) -->
        <h3 [ngClass]="passed ? 'text-success fw-bold' : 'text-danger fw-bold animate-shake'">
            {{ passed ? '🎉 Congratulations! You Passed!' : '❌ Oops! Try Again!' }}
        </h3>

        <!-- 🎯 Barre de progression sous le quiz -->
        <div class="progress-bar-container mt-3">
            <div class="progress-bar">
                <div class="progress" [style.width.%]="(score / quiz.maxGrade) * 100"></div>
            </div>
        </div>

        <!-- 💯 Affichage du Score -->
        <p class="score mt-2">
            💯 <strong>Your Score:</strong> <span class="score-number">{{ score }}/{{ quiz.maxGrade }}</span>
        </p>

        <!-- 🔍 Actions supplémentaires -->
        <div class="quiz-actions">
            <button class="btn btn-outline-primary btn-lg" (click)="reviewQuiz()">🔍 Review Answers</button>
            <button class="btn btn-primary btn-lg" (click)="restartQuiz()">🔄 Restart Quiz</button>
        </div>
    </div>
</div>




<app-footer></app-footer>
