<app-navbar></app-navbar>

<!-- üèÜ HEADER du Quiz -->
<section class="page-header page-header--bg-two" data-jarallax data-speed="0.3">
    <div class="page-header__bg jarallax-img"></div>
    <div class="page-header__overlay"></div>
    <div class="container text-center">
        <h2 class="page-header__title">üéØ {{ quiz?.quizName }}</h2>
        <ul class="page-header__breadcrumb list-unstyled">
            <li><a routerLink="/">Training</a></li>
            <li><span>Quiz</span></li>
        </ul>
    </div>
</section>

<section class="quiz-section">
    <div class="quiz-container">
        <h3 class="quiz-title">üìù Answer the Questions Below</h3>

        <!-- ‚úÖ Timer Cercle -->
        <div *ngIf="!submitted && !isTimeUp" class="timer-circle">
            <svg>
                <circle cx="50" cy="50" r="45"></circle>
                <circle 
                    cx="50" cy="50" r="45" 
                    [style.stroke-dashoffset]="circleDashoffset"
                    [ngClass]="timerColor">
                </circle>
            </svg>
            <div class="timer-text">
                {{ getFormattedTime() }}
            </div>
        </div>

        <!-- ‚úÖ Message si le temps est √©coul√© -->
        <div *ngIf="isTimeUp" class="alert alert-danger text-center">
            ‚ùå Time is up! Your quiz has been automatically submitted.
        </div>

        <!-- ‚úÖ Affichage des questions si le quiz est en cours -->
        <div *ngIf="!submitted && !isTimeUp && questions?.length" class="quiz-card">
            <div class="progress-indicator">
                <span>Question {{ currentQuestionIndex + 1 }} / {{ questions.length }}</span>
            </div>

            <h4 class="question-title">
                <span class="question-number">‚ùì Question {{ currentQuestionIndex + 1 }}:</span>
                {{ questions[currentQuestionIndex]?.questionText }}
            </h4>

            <div class="answers-container">
                <div *ngFor="let answer of questions[currentQuestionIndex]?.quizAnswers" class="answer-option">
                    <label class="answer-label">
                        <input 
                            type="checkbox" 
                            [value]="answer.idQuizA"
                            (change)="toggleAnswer(answer.idQuizA, questions[currentQuestionIndex].idQuizQ)"
                            class="form-check-input"
                        />
                        <span class="answer-text">‚úÖ {{ answer.answerText }}</span>
                    </label>
                </div>
            </div>

            <div class="quiz-navigation">
                <button (click)="previousQuestion()" class="btn btn-secondary" [disabled]="currentQuestionIndex === 0">
                    ‚¨ÖÔ∏è Previous
                </button>
                <button (click)="nextQuestion()" class="btn btn-primary" *ngIf="currentQuestionIndex < questions.length - 1">
                    Next ‚û°Ô∏è
                </button>
                <button (click)="submitQuiz()" class="btn btn-success" *ngIf="currentQuestionIndex === questions.length - 1">
                    ‚úÖ Submit
                </button>
            </div>
        </div>

        <!-- ‚úÖ R√©sultat du quiz avec Progress Bar -->
        <div *ngIf="submitted" class="quiz-result-container">
            <div class="score-card shadow-lg p-4 rounded animate-fade-in">
                <h3 [ngClass]="passed ? 'text-success fw-bold' : 'text-danger fw-bold animate-shake'">
                    {{ passed ? 'üéâ Congratulations! You Passed!' : '‚ùå Oops! Try Again!' }}
                </h3>

                <div class="progress-bar-container mt-3">
                    <div class="progress-bar">
                        <div class="progress" [style.width.%]="(score / quiz.maxGrade) * 100"></div>
                    </div>
                </div>

                <p class="score mt-2">
                    üíØ <strong>Your Score:</strong> <span class="score-number">{{ score }}/{{ quiz.maxGrade }}</span>
                </p>
            </div>
        </div>
    </div>
</section>

<app-footer></app-footer>
